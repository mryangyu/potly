(function(){var app,deep,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};Array.prototype.remove=function(){var L,a,ax,what;for(what=void 0,a=arguments,L=a.length,ax=void 0;L&&this.length;)for(what=a[--L];-1!==(ax=this.indexOf(what));)this.splice(ax,1);return this},Array.prototype.insert=function(index,item){return this.splice(index,0,item)},Array.prototype.append=function(other){return Array.prototype.push.apply(this,other)},Array.prototype.prepend=function(another){return Array.prototype.unshift.apply(this,another)},Array.prototype.join2=function(one,two){var str;return null==one&&(one=", "),null==two&&(two=" and "),this.length<=1?this.join(two):(str="",str+=this.slice(0,-1).join(one),str+=two+this.slice(-1)[0])},"undefined"!=typeof module&&null!==module&&(_=require("lodash")),_.defaultsDeep=_.partialRight(_.merge,deep=function(value,other){return _.merge(value,other,deep)}),_.isHash=function(val){return _.isObject(val)&&!_.isArray(val)},_.formatTel=function(tel,onlyDashes){var city,country,number,value;if(null==onlyDashes&&(onlyDashes=!1),!tel)return"";if(value=tel.toString().trim().replace(/^\+/,""),value.match(/[^0-9]/))return tel;switch(country=void 0,city=void 0,number=void 0,value.length){case 10:country=1,city=value.slice(0,3),number=value.slice(3);break;case 11:country=value[0],city=value.slice(1,4),number=value.slice(4);break;case 12:country=value.slice(0,3),city=value.slice(3,5),number=value.slice(5);break;default:return tel}return 1===country&&(country=""),number=number.slice(0,3)+"-"+number.slice(3),onlyDashes?(((null!=country?country.length:void 0)?country+"-":"")+city+"-"+number).trim():(country+" ("+city+") "+number).trim()},_.formatHeight=function(cm){var INCH_TO_CM,feet,inches,rem;if(null!=cm)return INCH_TO_CM=2.54,inches=cm/INCH_TO_CM,feet=Math.floor(inches/12),rem=Math.round(inches%12),12===rem&&(feet+=1,rem=0),""+feet+"'"+rem+'"'},_.formatWeight=function(kg){var KG_TO_POUNDS;if(null!=kg)return KG_TO_POUNDS=2.20462,(kg>91?kg:Math.floor(kg*KG_TO_POUNDS))+"lbs"},_.wordTrim=function(str,MAX_LENGTH,ellipses){var hasTrimmedWords,i,origI;if(null==MAX_LENGTH&&(MAX_LENGTH=40),null==ellipses&&(ellipses=!1),ellipses&&(MAX_LENGTH-=3),str=str.trim(),i=Math.min(MAX_LENGTH,str.length),origI=i,void 0!==str[i]&&" "!==str[i])for(;" "!==str[i]&&i>=0;)i-=1;return hasTrimmedWords=i!==origI,str=-1===i?str.substring(0,MAX_LENGTH):str.substring(0,i),ellipses&&hasTrimmedWords&&(str+="..."),str},_.pickGood=function(obj,omit){var clone,k,v;if(null==omit&&(omit=[]),null!=obj){clone={};for(k in obj)v=obj[k],"_"===k[0]||_.isFunction(v)||__indexOf.call(omit,k)>=0||(clone[k]=v);return clone}},_.changed=function(cur,old){var changed,k,v;changed=_.clone(cur);for(k in old)v=old[k],void 0===changed[k]?changed[k]=null:_.isEqual(changed[k],v)&&delete changed[k];return changed},"undefined"!=typeof module&&null!==module&&(module.exports=_),"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(str){return this.slice(0,str.length)===str}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(str){return this.slice(-str.length)===str}),"function"!=typeof String.prototype.addCommas&&(String.prototype.addCommas=function(){var rgx,str,x,x1,x2;for(str=this,str+="",x=str.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"",rgx=/(\d+)(\d{3})/;rgx.test(x1);)x1=x1.replace(rgx,"$1,$2");return x1+x2}),"function"!=typeof String.prototype.lpad&&(String.prototype.lpad=function(padString,length){var str;for(str=this;str.length<length;)str=padString+str;return str}),"function"!=typeof String.prototype.rpad&&(String.prototype.rpad=function(padString,length){var str;for(str=this;str.length<length;)str+=padString;return str}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),"function"!=typeof String.prototype.capitalize&&(String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)}),"function"!=typeof String.prototype.ellipses&&(String.prototype.ellipses=function(maxLength){return null==maxLength&&(maxLength=140),this.length>maxLength?this.substring(0,maxLength-3)+"...":this}),app=angular.module(conf.app.site_name,["ngRoute","ngAnimate","ngCookies","angularMoment","angular-loading-bar","perfect_scrollbar","infinite-scroll","angularFileUpload","nya.bootstrap.select","oc.lazyLoad"]),app.config(function($logProvider){return $logProvider.debugEnabled(conf.app.console.debug)}),app.config(function(cfpLoadingBarProvider){return cfpLoadingBarProvider.includeBar=!0,cfpLoadingBarProvider.includeSpinner=!1,cfpLoadingBarProvider.latencyThreshold=100}),app.run(function($rootScope,$location,$routeParams,$window,$http,$templateCache,$filter,$log,Navigation,Layout,SEO,GoogleAnalyticsService,MixpanelService){return FastClick.attach(document.body),$log.info("App loaded"),$rootScope.env=env,$rootScope.conf=conf,$rootScope.nav=new Navigation,$rootScope.layout=new Layout,$rootScope.seo=new SEO,$rootScope.authUserIs=function(type){var _ref;return null==type&&(type=""),null!=$rootScope.authUser&&type.length?(_ref=$rootScope.authUser.account.type,__indexOf.call(type.split("|"),_ref)>=0):!1},$rootScope.authenticated=function(authUser,source){null!=authUser&&($log.info("authenticated:",authUser.id),$rootScope.authUser=authUser,GoogleAnalyticsService.setUser(authUser),MixpanelService.setUser(authUser,source))},$rootScope.deauthenticate=function(options){null==options&&(options={}),$rootScope.authUser=null,options.clearHistory&&($rootScope.nav.history=[])},$rootScope.processHeaders=function(){},$rootScope.isBinding=function(){var _ref;return"$apply"===(_ref=$rootScope.$$phase)||"$digest"===_ref},$rootScope.safeApply=function(){return $rootScope.isBinding()?void 0:$rootScope.$apply()},$rootScope.onLoaded=function(next){return setTimeout(function(){return function(){return 0!==$rootScope.ajaxCount||$rootScope.isBinding()?$rootScope.onLoaded(next):"function"==typeof next?next():void 0}}(this),800)},$rootScope.template=function(){var template,_i,_len;for(_i=0,_len=arguments.length;_len>_i;_i++)if(template=arguments[_i],template=$filter("urlFormat")(template),$templateCache.get(template))return template}}),app.controller("HomeCtrl",function(){}),app.controller("LoginCtrl",function($rootScope,$scope,$location,$window,$routeParams,LoginService){return $scope.login=new LoginService(function(user){return null!=LoginService.returnUrl?($location.url(LoginService.returnUrl),LoginService.returnUrl=null):$location.url(1===user.sign_in_count?"/members/me":"/account")}),$scope.login.forgot=$routeParams.forgot,"/logout"===$location.path()?$scope.login.logout(function(){return $location.url("/login").replace()}):"/login/forgot"===$location.path()?$scope.login.forgot=!0:void 0}),app.controller("GlobalCtrl",function($rootScope,$scope,$timeout,$log,SignupService,LoginService,Alert,MixpanelService){var authorizeModal;return authorizeModal=$("#authorize.modal:first"),$scope.alerts=Alert.alerts,$rootScope.requireAuth=function(done,action,accountTypes,city){var authenticated,loginAuthenticated,signUpAuthenticated,_authUser,_ref;return null==action&&(action="action"),null==accountTypes&&(accountTypes=["consumer","entertainer","agency"]),authorizeModal.hasClass("in")?void 0:(ZopimService.enableChat(),null!=$rootScope.authUser?($log.debug(accountTypes,$rootScope.authUser.account.type),_ref=$rootScope.authUser.account.type,__indexOf.call(accountTypes,_ref)>=0?done($rootScope.authUser):(new Alert("You are not authorized to "+action,"warning").show(),done())):(null==city&&(city=$rootScope.nav.city),_authUser=null,authenticated=function(authUser){return _authUser=authUser,authorizeModal.modal("hide"),new Alert("Now back to "+action+"...").show()},loginAuthenticated=function(authUser){return MixpanelService.trackRequireAuth("login",action,authUser),authenticated(authUser)},signUpAuthenticated=function(authUser){return MixpanelService.trackRequireAuth("signup",action,authUser),authenticated(authUser)},authorizeModal.off(),$scope.action=action,$scope.accountTypes=accountTypes,$scope.signup=new SignupService(signUpAuthenticated),$scope.login=new LoginService(loginAuthenticated),null!=city&&($scope.signup.account.city_id=city.id),$rootScope.safeApply(),authorizeModal.modal("show"),MixpanelService.trackRequireAuth("show",action),authorizeModal.on("hide.bs.modal",function(){return null==_authUser&&MixpanelService.trackRequireAuth("cancel",action),$rootScope.nav.leaveWarningOff(),done(_authUser),!0}),authorizeModal.on("hidden.bs.modal",function(){var finish;authorizeModal.off(),finish=null,$scope.signup=null,$scope.login=null,$scope.accountTypes=null})))}}),app.controller("NavbarCtrl",function($rootScope,$routeParams,$scope,$http,$location,Notifications){var collapser,navbar,toggle;return navbar=$("nav.navbar:first"),toggle=navbar.find(".navbar-toggle:first"),$scope.notifications=new Notifications,$scope.isActive=function(controllers,id){var ctrlMatch,idMatch,_ref;return ctrlMatch=!1,idMatch=id===$routeParams.id,_.isArray(controllers)?(_ref=$rootScope.mainController,ctrlMatch=__indexOf.call(controllers,_ref)>=0):ctrlMatch=$rootScope.mainController===controllers,idMatch&&ctrlMatch},$rootScope.collapsedNav=function(){return toggle.hasClass("collapsed")?void 0:toggle.click()},navbar.on("click","a[href]",null,function(){return $rootScope.collapsedNav()}),collapser=navbar.find(".navbar-collapse"),collapser.on("shown.bs.collapse",function(){return navbar.find(".expand-xs").addClass("open").on("hide.bs.dropdown",function(e){return navbar.hasClass("open")?(e.preventDefault(),!1):!0}),navbar.addClass("open")}),collapser.on("hidden.bs.collapse",function(){return navbar.removeClass("open")})}),app.factory("Alert",function($rootScope,$timeout){var AlertDialog,variableDuration;return variableDuration={min:{"char":10,duration:3e3},max:{"char":100,duration:6e3},getDuration:function(textLength){var goodLength,perc;return null==textLength&&(textLength=0),goodLength=Math.max(this.min.char,Math.min(this.max.char,textLength)),perc=(goodLength-this.min.char)/(this.max.char-this.min.char),Math.floor(perc*(this.max.duration-this.min.duration)+this.min.duration)}},AlertDialog=function(){function AlertDialog(message,_class){this.message=message,this["class"]=null!=_class?_class:"info",_.isObject(this.message)&&(this.obj=!0),this.length=this._getMessageLength()}return AlertDialog.alerts=[],AlertDialog.prototype._getMessageObjLength=function(){var key,length,val,_i,_len,_ref;for(length=0,_ref=this.message,val=_i=0,_len=_ref.length;_len>_i;val=++_i)key=_ref[val],length+=val.length;return length},AlertDialog.prototype._getMessageLength=function(){return null!=this.obj?this._getMessageObjLength():this.message.length},AlertDialog.prototype.show=function(next,duration){return duration||(duration=variableDuration.getDuration(this.length)),AlertDialog.alerts.push(this),$rootScope.safeApply(),$timeout(function(_this){return function(){return AlertDialog.alerts.remove(_this),"function"==typeof next?next():void 0}}(this),duration)},AlertDialog.prototype.close=function(){return AlertDialog.alerts.remove(this)},AlertDialog}()}),app.factory("Confirm",function($rootScope){var ConfirmDialog;return ConfirmDialog=function(){function ConfirmDialog(message,action,title,cancellable,cancelAction){this.message=message,this.action=action,this.title=title,this.cancellable=null!=cancellable?cancellable:!0,this.cancelAction=cancelAction,this.modal=$("#confirm.modal:first")}return ConfirmDialog.prototype.show=function(next){$rootScope.confirm=this,this.modal.modal("show"),this.modal.on("hidden.bs.modal",function(_this){return function(){_this.modal.off(),next(_this.ok),$rootScope.safeApply()}}(this))},ConfirmDialog.prototype.submit=function(ok){this.ok=ok,this.modal.modal("hide")},ConfirmDialog}()}),app.factory("Prompt",function(){var PromptDialog;return PromptDialog=function(){function PromptDialog(msg,defaultValue){this.msg=msg,this.defaultValue=null!=defaultValue?defaultValue:""}return PromptDialog.prototype.show=function(next){var input;return input=prompt(this.msg,this.defaultValue),"function"==typeof next?next(input):void 0},PromptDialog}()}),angular.module("perfect_scrollbar",[]).directive("perfectScrollbar",function($parse,$timeout){return{restrict:"E",transclude:!0,template:"<div><div ng-transclude></div></div>",replace:!0,link:function($scope,$elem,$attr){$elem.perfectScrollbar({wheelSpeed:$parse($attr.wheelSpeed)()||50,wheelPropagation:$parse($attr.wheelPropagation)()||!1,minScrollbarLength:$parse($attr.minScrollbarLength)()||!1,useBothWheelAxes:$parse($attr.useBothWheelAxes)()||!1,suppressScrollX:$parse($attr.suppressScrollX)()||!1,suppressScrollY:$parse($attr.suppressScrollY)()||!1}),$attr.refreshOnChange&&$scope.$watchCollection($attr.refreshOnChange,function(){$timeout(function(){return $elem.perfectScrollbar("update")},10),"bottom"===$attr.dock&&$timeout(function(){return $elem.animate({scrollTop:$elem[0].scrollHeight})},200)}),$elem.bind("$destroy",function(){$elem.perfectScrollbar("destroy")})}}}),app.directive("responsive",function($window,$timeout,$rootScope){return{restrict:"E",scope:{containerLg:"@",containerMd:"@",containerSm:"@"},link:function($scope,$element){var changeContainer;changeContainer=function(){var $newParent;return $newParent=null,$newParent=angular.element($rootScope.layout.lt("md")?$scope.containerSm:$scope.containerMd),(null!=$newParent?$newParent.attr("id"):void 0)!==$element.parent().attr("id")?$element.appendTo($newParent):void 0},changeContainer(),$(window).on("resize",changeContainer),$element.bind("$destroy",function(){return $(window).off("resize",changeContainer)})}}}),app.filter("readable",function(){return function(obj){return obj?_.isArray(obj)?obj.join(", "):_.isString(obj)?obj:JSON.stringify(obj):""}}),app.filter("urlFormat",function(){return function(str){return(null!=str?str.length:void 0)?str.toLowerCase().replace(" ","-"):""}}),app.factory("opHttp",function($q,$log,$location,$rootScope,$window,GoogleAnalyticsService,MixpanelService,Alert,Confirm){var timeout;return timeout=conf.app.ui.timeout,{request:function(config){var _ref;return config.timeout=timeout,config.withCredentials=!0,$rootScope.ajaxCount=(null!=(_ref=$rootScope.ajaxCount)?_ref:0)+1,$rootScope.busy||config.background||($rootScope.busy=!0),config.cached||GoogleAnalyticsService.trackApiCall(config),"GET"!==config.method&&null!=config.data&&(config.data=_.pickGood(config.data)),config||$q.when(config)},response:function(response){return $rootScope.ajaxCount&&$rootScope.ajaxCount--,$rootScope.busy&&0===$rootScope.ajaxCount&&($rootScope.busy=!1),response||$q.when(response)},responseError:function(rejection){var done,_ref,_ref1,_ref2;switch($rootScope.ajaxCount&&$rootScope.ajaxCount--,done=function(){return $rootScope.busy&&0===$rootScope.ajaxCount&&($rootScope.busy=!1),$q.reject(rejection)},rejection.status){case 0:(_ref=rejection.config.url)!==ContextProvider.getUserUrl&&_ref!==ContextProvider.loginUrl&&rejection.config.background!==!0&&new Alert("There seems to be an internet network issue. Please try again.","info").show(null,5e3);break;case 403:return new Alert("You are unauthorized to perform this action","warning").show(),done();case 401:return(_ref1=rejection.config.url)!==ContextProvider.getUserUrl&&_ref1!==ContextProvider.loginUrl&&(null!=$rootScope.authUser&&(MixpanelService.trackHttpRejection(rejection),new Confirm("It appears you are no longer logged in. Do you want to login?").show(function(ok){return ok?$rootScope.nav.to("login"):void 0})),$rootScope.deauthenticate()),done()}return MixpanelService.trackHttpRejection(rejection),_.isEmpty(rejection.data)?done():(new Alert(null!=(_ref2=rejection.data.error)?_ref2:rejection.data,"warning").show(),done())}}}),app.config(function($routeProvider,$locationProvider,$httpProvider){return $httpProvider.interceptors.push("opHttp"),$routeProvider.when("/",{title:"Home",controller:"HomeCtrl",templateUrl:"tmpl/home.html"}),$locationProvider.html5Mode({enabled:!0,requireBase:!1}).hashPrefix("!")})}).call(this);
//# sourceMappingURL=app.min.js.map